# 快速测试示例

## 测试 1: 基本流程（约 2 分钟）

### 步骤

1. 在输入框输入："总结一下今天的工作"
2. 观察工具栏出现
3. 在工具栏中切换模型（例如从 DeepSeek 切换到 Qwen）
4. 修改输入框内容为："详细总结今天的工作进展"
5. 点击发送按钮
6. 打开浏览器控制台（F12）查看日志

### 预期控制台输出

```
🔄 开始切换模型: {from: "deepseek/deepseek-chat", to: "qwen/qwen-plus"}
✅ 已切换模型: qwen - qwen-plus
💡 提示: 新模型将在下次AI请求时生效
📋 准备发送AI请求: {
  prompt: "详细总结今天的工作进展",
  isConnectedMode: false,
  connectedNotesCount: 0
}
🤖 普通模式 - AI生成便签
  📌 提示词: 详细总结今天的工作进展
🔍 开始检查AI配置完整性...
  🔧 当前使用的模型: {provider: "qwen", model: "qwen-plus"}
  ✅ AI配置检查结果: {status: "ready", ...}
🎯 创建AI便签占位符，位置: ...
🚀 开始AI生成，便签ID: ...
  📌 使用模型: qwen / qwen-plus
```

### ✅ 验证点

- [ ] 使用了最新切换的模型（qwen）
- [ ] 使用了最新的提示词（"详细总结..."）
- [ ] 日志显示完整

---

## 测试 2: 插槽连接模式（约 3 分钟）

### 步骤

1. 在画布上创建 3 个普通便签（内容随意）
2. 点击第一个便签上的连接点（小圆圈）
3. 点击第二个便签上的连接点
4. 观察底部插槽容器显示 "2" 个连接
5. 在输入框输入："汇总"
6. 在工具栏切换模型
7. 移除第一个便签的连接（点击插槽中的 1 号槽位）
8. 添加第三个便签的连接
9. 修改输入框为："详细分析"
10. 点击发送按钮
11. 查看控制台日志

### 预期控制台输出

```
✅ 添加便签连接: {title: "便签1", index: 1, totalConnections: 1}
✅ 添加便签连接: {title: "便签2", index: 2, totalConnections: 2}
🗑️ 移除便签连接: {title: "便签1", ...}
  📊 剩余连接数: 1
✅ 添加便签连接: {title: "便签3", index: 2, totalConnections: 2}
🔄 开始切换模型: ...
✅ 已切换模型: ...
📋 准备发送AI请求: {
  prompt: "详细分析",
  isConnectedMode: true,
  connectedNotesCount: 2
}
🤖 连接模式 - 汇总便签内容
  📌 提示词: 详细分析
  📌 连接的便签数量: 2
  📌 便签标题: 便签2, 便签3
  🔧 当前使用的模型: {...}
📝 构建AI提示词...
  📌 最终AI提示词长度: ...
  📌 提示词预览: 请根据以下便签内容进行处理（指令：详细分析）...
🎯 创建AI便签占位符，位置: ...
🚀 开始AI生成，便签ID: ...
  📌 使用模型: ...
```

### ✅ 验证点

- [ ] 使用了便签 2 和便签 3（不包含已移除的便签 1）
- [ ] 使用了最新的提示词（"详细分析"）
- [ ] 使用了最新切换的模型
- [ ] 插槽索引正确重新分配

---

## 测试 3: 连接模式切换（约 1 分钟）

### 步骤

1. 连接 2 个便签到插槽
2. 点击插槽容器中的模式切换按钮（"汇总" ↔ "替换"）
3. 再次切换回来
4. 查看控制台日志

### 预期控制台输出

```
🔄 切换连接模式: 替换模式
🔄 切换连接模式: 汇总模式
```

### ✅ 验证点

- [ ] 模式切换有日志记录
- [ ] 模式切换按钮工作正常

---

## 测试 4: 清空并重新连接（约 2 分钟）

### 步骤

1. 连接 3 个便签到插槽
2. 点击"清空连接"按钮（垃圾桶图标）
3. 重新连接 2 个不同的便签
4. 输入提示词并发送
5. 查看控制台日志

### 预期控制台输出

```
✅ 添加便签连接: {index: 1, totalConnections: 1}
✅ 添加便签连接: {index: 2, totalConnections: 2}
✅ 添加便签连接: {index: 3, totalConnections: 3}
🧹 清空所有连接，共 3 个
✅ 添加便签连接: {index: 1, totalConnections: 1}
✅ 添加便签连接: {index: 2, totalConnections: 2}
📋 准备发送AI请求: {connectedNotesCount: 2}
```

### ✅ 验证点

- [ ] 清空后索引从 1 重新开始
- [ ] 使用正确的连接便签数量
- [ ] 没有使用之前清空的便签

---

## 常见问题排查

### 问题 1: 看不到控制台日志

**解决：**

1. 按 F12 打开开发者工具
2. 切换到 "Console" 标签
3. 确保没有过滤日志（All levels 选项）

### 问题 2: 模型没有切换成功

**检查：**

1. 查看控制台是否有 "✅ 已切换模型" 日志
2. 如果有错误日志，检查 API 密钥配置
3. 尝试刷新页面后重试

### 问题 3: 插槽连接没有生效

**检查：**

1. 确保便签上的连接点是可见的（小圆圈）
2. 点击连接点后应该看到插槽容器
3. 查看控制台 "✅ 添加便签连接" 日志

---

## 快速验证脚本

如果你想自动化测试，可以在控制台运行：

```javascript
// 查看当前连接状态
console.log(
  "连接数量:",
  window.useConnectionStore?.getState().connectedNotes.length
);
console.log(
  "连接便签:",
  window.useConnectionStore?.getState().connectedNotes.map((n) => n.title)
);

// 查看当前模型配置
// (需要先 import aiService)
```

---

## 总结

✅ 所有测试通过表示：

- 模型切换功能正常
- 插槽连接状态同步正常
- 提示词更新正常
- 日志系统完整
- 状态管理健壮

🎉 可以放心使用！
