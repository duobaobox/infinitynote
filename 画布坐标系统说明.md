# 画布坐标系统说明

## 📍 当前坐标系统

### 初始状态（重置后）

当你重置画布（按 Ctrl+0）或首次打开应用时：

```typescript
DEFAULT_VIEWPORT = {
  scale: 1,
  offset: { x: 0, y: 0 },
};
```

### 坐标原点位置

**重要：画布的 (0, 0) 点在屏幕的左上角！**

```
屏幕左上角 = 画布坐标 (0, 0)
┌─────────────────────────────────┐
│ (0,0) ← 这里是画布原点            │
│                                  │
│         你看到的屏幕区域          │
│                                  │
│                                  │
└─────────────────────────────────┘
```

## 🗺️ 完整的画布空间

画布的**实际绘制区域**是一个巨大的正方形：

```
        网格左上角
        (-50000, -50000)
              ↓
    ┌─────────────────────────────────┐
    │                                  │
    │         负坐标区域               │
    │                                  │
    │         (-x, -y)                 │
    │                                  │
    ├──────────(0,0)──────────────────┤ ← 屏幕左上角对齐这里
    │         ↑                        │
    │    画布坐标原点                  │
    │                                  │
    │         正坐标区域               │
    │                                  │
    │         (+x, +y)                 │
    │                                  │
    └─────────────────────────────────┘
              ↑
    网格右下角
    (50000, 50000)
```

### 坐标范围

- **X 轴范围：** -50,000 到 +50,000（共 100,000 像素）
- **Y 轴范围：** -50,000 到 +50,000（共 100,000 像素）
- **原点位置：** (0, 0) 在整个画布的中心偏左上位置

## 🎯 你现在看到的是什么区域？

### 重置后（offset = {x: 0, y: 0}）

假设你的屏幕是 1920×1080：

```
画布坐标视图：

  (-50000, -50000)                                    (50000, -50000)
        ┌───────────────────────────────────────────────────┐
        │                                                    │
        │         这些区域被隐藏在屏幕外                     │
        │         (需要向左上拖动才能看到)                   │
        │                                                    │
        ├─────────────────────────────────────────────────────
        │ ← 你的屏幕在这里开始
        │ (0, 0)
        │ ┌──────────────────────┐ ← 屏幕可见区域
        │ │                      │   (1920×1080)
        │ │   你当前看到的       │
        │ │   画布区域           │
        │ │                      │
        │ │ (0,0) → (1920,1080)  │
        │ └──────────────────────┘
        │
        │         这些区域也被隐藏在屏幕外
        │         (需要向右下拖动才能看到)
        │
        │
        └───────────────────────────────────────────────────┘
  (-50000, 50000)                                     (50000, 50000)
```

**结论：重置后，你看到的是画布左上角的一小块区域！**

## 🧭 不同拖动位置的坐标关系

### 情况 1：初始位置（offset = {x: 0, y: 0}）

```
屏幕显示画布坐标：(0, 0) 到 (1920, 1080)
```

### 情况 2：向右拖动 500px（offset = {x: 500, y: 0}）

```
画布向右移动 → 你看到的是画布更左边的部分
屏幕显示画布坐标：(-500, 0) 到 (1420, 1080)
```

### 情况 3：向下拖动 300px（offset = {x: 0, y: 300}）

```
画布向下移动 → 你看到的是画布更上面的部分
屏幕显示画布坐标：(0, -300) 到 (1920, 780)
```

### 情况 4：向左上拖动（offset = {x: -1000, y: -500}）

```
画布向左上移动 → 你看到的是画布更右下的部分
屏幕显示画布坐标：(1000, 500) 到 (2920, 1580)
```

## 🎨 便签坐标示例

### 在屏幕中心创建便签

假设屏幕是 1920×1080，在屏幕中心点击：

```typescript
// 屏幕坐标
clickX = 960 (屏幕宽度的一半)
clickY = 540 (屏幕高度的一半)

// 转换为画布坐标（offset = {x: 0, y: 0}, scale = 1）
canvasX = (960 - 0) / 1 = 960
canvasY = (540 - 0) / 1 = 540

// 便签会被创建在画布坐标 (960, 540)
```

### 如果画布已经拖动过

假设 offset = {x: 500, y: 300}，在屏幕中心点击：

```typescript
// 屏幕坐标
clickX = 960
clickY = 540

// 转换为画布坐标
canvasX = (960 - 500) / 1 = 460
canvasY = (540 - 300) / 1 = 240

// 便签会被创建在画布坐标 (460, 240)
```

## 🏠 如何让初始位置在画布中心？

如果你希望重置后看到的是画布的**中心区域**，而不是左上角，可以修改初始偏移：

### 方案 1：修改 DEFAULT_VIEWPORT

```typescript
// 当前
const DEFAULT_VIEWPORT = {
  scale: 1,
  offset: { x: 0, y: 0 }, // 从左上角开始
};

// 修改为：让屏幕中心对齐画布中心 (0, 0)
const DEFAULT_VIEWPORT = {
  scale: 1,
  offset: {
    x: window.innerWidth / 2, // 屏幕宽度的一半
    y: window.innerHeight / 2, // 屏幕高度的一半
  },
};
```

这样重置后，屏幕中心就会对齐到画布坐标 (0, 0)。

### 方案 2：让初始位置在网格中心

```typescript
// 让屏幕中心对齐到网格的实际中心
const DEFAULT_VIEWPORT = {
  scale: 1,
  offset: {
    x: window.innerWidth / 2,
    y: window.innerHeight / 2,
  },
};
```

## 🔍 验证方法

### 方法 1：查看第一个便签的坐标

1. 重置画布（Ctrl+0）
2. 在屏幕左上角双击创建便签
3. 打开浏览器控制台，查看便签的 position 属性
   - 如果接近 (0, 0)，说明你在画布左上角
   - 如果是负值，说明你在画布中心

### 方法 2：拖动测试

1. 重置画布
2. 向左拖动画布

   - 如果很快看到网格边界 → 你在画布左侧边缘
   - 如果拖很久才看到边界 → 你在画布中心或右侧

3. 向上拖动画布
   - 如果很快看到网格边界 → 你在画布上侧边缘
   - 如果拖很久才看到边界 → 你在画布中心或下侧

## 🎯 当前设计的考虑

**为什么默认在左上角而不是中心？**

1. **Web 开发习惯：** (0, 0) 在左上角是标准做法
2. **便签创建逻辑：** 新便签从可见区域开始，避免出现在负坐标
3. **性能考虑：** 大部分便签在正坐标区域，简化了坐标计算

**优点：**

- ✅ 所有便签都在正坐标，便于理解
- ✅ 第一个便签从 (0, 0) 附近开始，逻辑清晰
- ✅ 向右下扩展画布更自然

**缺点：**

- ❌ 不太符合"无限画布"的概念（应该从中心开始）
- ❌ 向左上拖动的空间较小（只有负坐标区域）

## 💡 建议

**如果你希望更"无限"的感觉：**

建议修改初始位置到画布中心，让用户可以向四面八方自由扩展。我可以帮你实现这个修改！

---

**总结回答你的问题：**

🎯 **重置画布后，你看到的是画布的左上角区域（坐标 0,0 附近），而不是中心！**

整个画布从 (-50000, -50000) 延伸到 (50000, 50000)，但默认视口从 (0, 0) 开始，这意味着：

- ✅ 你可以向右下拖动很远（最多到 50000）
- ⚠️ 你向左上拖动的空间有限（最多到 -50000，相对较近）

需要我帮你修改成从画布中心开始吗？
