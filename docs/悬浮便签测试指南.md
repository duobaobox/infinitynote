# 悬浮便签功能测试指南

## ✅ 问题已修复

### 修复内容

1. **ThemeProvider 错误** - 已修复 `useTheme must be used within ThemeProvider` 错误

   - 为 `FloatingNoteContent` 组件添加了 `ThemeProvider` 包装
   - 现在悬浮窗口有独立的主题上下文

2. **类型定义** - 已添加 `floating` 到 `ToolbarAction` 类型

### 安全警告说明

控制台中的 **Electron Security Warning** 是开发环境的正常警告，不影响功能使用：

```
Electron Security Warning (Insecure Content-Security-Policy)
This renderer process has either no Content Security Policy set
or a policy with "unsafe-eval" enabled.
```

**解释**：

- 这是 Electron 的安全建议，提示应该设置内容安全策略（CSP）
- 在开发环境中可以忽略
- 生产环境打包后会自动处理

**后续优化**（可选）：
可以在 `electron/main.cjs` 中添加 CSP 配置：

```javascript
webPreferences: {
  // ... 其他配置
  webSecurity: true,
  contentSecurityPolicy: "default-src 'self'"
}
```

## 🧪 测试步骤

### 1. 启动应用

```bash
# 方式一：使用开发脚本
npm run electron:dev

# 方式二：分别启动
# 终端1
npm run dev

# 终端2（等待 vite 启动完成）
cross-env NODE_ENV=development electron .
```

### 2. 创建测试便签

1. 在画布中创建一个新便签
2. 添加一些标题和内容
3. 选择一个喜欢的颜色

### 3. 测试悬浮功能

#### 3.1 创建悬浮便签

- 鼠标悬停在便签上
- 工具栏会自动显示
- 点击 📌 **悬浮** 按钮
- 应该会弹出一个独立的悬浮窗口

**预期结果**：

- ✅ 显示成功提示："便签已设为悬浮显示"
- ✅ 弹出独立窗口，显示便签内容
- ✅ 窗口始终在最上层
- ✅ 窗口背景颜色与便签颜色一致

#### 3.2 测试窗口拖拽

- 在悬浮窗口的标题栏区域按住鼠标
- 拖拽窗口到不同位置

**预期结果**：

- ✅ 可以顺畅拖拽移动窗口
- ✅ 窗口跟随鼠标移动

#### 3.3 测试窗口大小调整

- 拖拽窗口的边缘或角落
- 调整窗口大小

**预期结果**：

- ✅ 可以调整窗口大小
- ✅ 最小尺寸限制为 250x150
- ✅ 内容随窗口大小自适应

#### 3.4 测试标题编辑

- 单击悬浮窗口的标题
- 修改标题内容
- 按 Enter 或点击其他地方保存

**预期结果**：

- ✅ 进入编辑模式，显示输入框
- ✅ 可以修改标题
- ✅ 保存后标题更新
- ✅ 主窗口中的便签标题也同步更新

#### 3.5 测试内容编辑

- 在悬浮窗口的内容区域点击
- 使用富文本编辑器修改内容
- 测试各种格式（加粗、斜体、列表等）

**预期结果**：

- ✅ 可以正常编辑内容
- ✅ 富文本编辑器工具栏显示正常
- ✅ 内容自动保存
- ✅ 主窗口中的便签内容也同步更新

#### 3.6 测试双向同步

- 保持悬浮窗口打开
- 在主窗口中编辑原始便签的内容或标题
- 观察悬浮窗口是否同步更新

**预期结果**：

- ✅ 主窗口修改后，悬浮窗口立即同步
- ✅ 悬浮窗口修改后，主窗口立即同步
- ✅ 双向同步无延迟

#### 3.7 测试多窗口

- 创建多个便签
- 为不同便签都创建悬浮窗口
- 同时操作多个悬浮窗口

**预期结果**：

- ✅ 可以同时打开多个悬浮窗口
- ✅ 每个窗口独立操作
- ✅ 数据同步互不干扰

#### 3.8 测试重复打开

- 为同一个便签多次点击"悬浮"按钮

**预期结果**：

- ✅ 不会创建重复窗口
- ✅ 聚焦到已存在的窗口

#### 3.9 测试关闭窗口

- 点击悬浮窗口的关闭按钮
- 或使用系统关闭快捷键

**预期结果**：

- ✅ 窗口正常关闭
- ✅ 最后的编辑内容已保存
- ✅ 主窗口中的便签仍然存在

#### 3.10 测试主题适配

- 在主窗口切换明亮/暗黑主题
- 观察悬浮窗口的主题变化

**预期结果**：

- ✅ 悬浮窗口主题与主窗口独立
- ✅ 便签颜色在不同主题下显示正确

## 🐛 常见问题排查

### 问题 1：点击悬浮按钮没反应

**检查**：

1. 打开开发者工具（Cmd+Option+I / Ctrl+Shift+I）
2. 查看 Console 是否有错误信息
3. 确认是否在 Electron 环境中运行

**解决方案**：

- 重启应用
- 确保使用 `npm run electron:dev` 而不是 `npm run dev`

### 问题 2：悬浮窗口无法拖拽

**检查**：

1. 确认鼠标在标题栏区域
2. 检查浏览器控制台是否有 CSS 错误

**解决方案**：

- 清除缓存重新构建
- 确认 CSS 文件正确加载

### 问题 3：数据不同步

**检查**：

1. 打开主窗口和悬浮窗口的开发者工具
2. 观察 Console 中的同步日志

**解决方案**：

- 查看是否有 IPC 通信错误
- 重启应用

### 问题 4：窗口显示不正常

**检查**：

1. 窗口大小是否过小
2. 是否有样式加载失败

**解决方案**：

- 调整窗口大小
- 重新加载窗口

## 📊 测试检查清单

使用此清单确保所有功能正常：

- [ ] 应用启动成功
- [ ] 创建便签成功
- [ ] 悬浮按钮可见且可点击
- [ ] 悬浮窗口正常弹出
- [ ] 窗口可拖拽移动
- [ ] 窗口可调整大小
- [ ] 标题可编辑
- [ ] 内容可编辑
- [ ] 富文本编辑器工作正常
- [ ] 悬浮窗 → 主窗口同步正常
- [ ] 主窗口 → 悬浮窗同步正常
- [ ] 多窗口管理正常
- [ ] 重复打开处理正确
- [ ] 关闭窗口正常
- [ ] 数据保存正确
- [ ] 主题颜色显示正确
- [ ] 无控制台错误（除了安全警告）

## 🎯 性能测试

### 测试场景

1. 创建 5-10 个悬浮窗口
2. 同时编辑多个窗口的内容
3. 快速切换窗口
4. 观察内存占用

**预期**：

- CPU 占用正常（<30%）
- 内存占用合理（每个窗口 <100MB）
- 无明显卡顿
- 数据同步及时

## 📝 反馈建议

测试过程中如发现问题，请记录：

1. **问题描述**：具体现象
2. **重现步骤**：如何触发问题
3. **期望行为**：应该怎样
4. **实际行为**：实际发生了什么
5. **环境信息**：
   - 操作系统
   - Electron 版本
   - Node.js 版本
6. **控制台日志**：相关错误信息
7. **截图/录屏**：如有可能

## 🚀 下一步

如果所有测试通过：

1. ✅ 功能可以正常使用
2. 📦 可以进行生产环境打包测试
3. 🎨 可以根据需求定制界面
4. 🔧 可以添加更多高级功能

---

**测试版本**: 2.0.0  
**测试日期**: 2025-10-12  
**测试人员**: ****\_\_\_****
