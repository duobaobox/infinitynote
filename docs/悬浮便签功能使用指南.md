# 悬浮便签功能使用指南

## 🎉 功能概述

悬浮便签功能允许你将画布中的任意便签"提取"出来，以独立的桌面窗口形式显示，始终置顶在其他应用之上，方便随时查看和编辑重要内容。

## ✨ 核心特性

1. **独立窗口** - 每个悬浮便签都是一个独立的窗口
2. **始终置顶** - 悬浮窗口永远显示在其他窗口之上
3. **可拖拽移动** - 通过标题栏拖拽移动窗口位置
4. **可调整大小** - 支持窗口大小调整
5. **双向同步** - 悬浮便签与原始便签数据实时同步
6. **独立编辑** - 在悬浮窗中可以直接编辑标题和内容
7. **跨平台支持** - 支持 Windows、macOS、Linux

## 📖 使用方法

### 创建悬浮便签

1. 在画布中找到你想要悬浮显示的便签
2. 将鼠标悬停在便签上，工具栏会自动显示
3. 点击工具栏中的 📌 **悬浮** 按钮
4. 便签将以独立窗口的形式显示在桌面上

### 编辑悬浮便签

#### 编辑标题

- 单击标题即可进入编辑模式
- 输入新标题后按 `Enter` 确认，或点击其他地方自动保存
- 按 `Escape` 取消编辑

#### 编辑内容

- 直接在内容区域点击即可开始编辑
- 支持所有富文本编辑功能（加粗、斜体、列表等）
- 内容会自动保存并同步到主窗口

### 移动悬浮窗口

- 在标题栏区域按住鼠标左键拖拽即可移动窗口

### 调整窗口大小

- 拖拽窗口边缘或角落即可调整大小
- 最小尺寸为 250x150 像素

### 关闭悬浮便签

- 点击窗口右上角的 ❌ 关闭按钮
- 关闭时会自动保存所有更改

## 🔄 数据同步

悬浮便签与画布中的原始便签保持实时双向同步：

- **悬浮窗口 → 画布**：在悬浮窗口中的任何编辑都会立即同步到画布中的原始便签
- **画布 → 悬浮窗口**：在画布中编辑原始便签，悬浮窗口也会同步更新

## 💡 使用技巧

### 多窗口管理

- 可以同时创建多个悬浮便签
- 每个便签对应一个独立的悬浮窗口
- 多次点击同一便签的悬浮按钮会聚焦到已存在的窗口

### 工作场景

1. **待办事项** - 将今日待办悬浮显示，随时查看进度
2. **参考资料** - 编写文档时悬浮参考内容
3. **快速笔记** - 会议或学习时快速记录要点
4. **提醒事项** - 重要事项始终可见，不会遗忘

### 性能优化

- 悬浮窗口使用与主窗口相同的编辑器组件，性能稳定
- 防抖保存机制避免频繁写入数据库
- 自动清理已关闭的窗口资源

## 🔧 技术实现

### 架构设计

```
主窗口 (Main Window)
  ↓ 用户点击"悬浮"按钮
  ↓ IPC 通信
Electron 主进程
  ↓ 创建新窗口
悬浮窗口 (Floating Window)
  ↕ 双向数据同步 (IPC)
主窗口 ↔ 数据库
```

### 关键特性

1. **无边框透明窗口**

   - `frame: false` - 移除系统边框
   - `transparent: true` - 透明背景
   - `alwaysOnTop: true` - 始终置顶

2. **拖拽实现**

   - 使用 `-webkit-app-region: drag` CSS 属性
   - 标题栏启用拖拽
   - 按钮区域禁用拖拽

3. **数据同步**
   - IPC 通信实现双向同步
   - 防抖优化减少通信频率
   - 事件监听器确保状态一致

## 🐛 故障排查

### 悬浮按钮不可用

- **原因**：可能不在 Electron 桌面应用环境中
- **解决**：请使用桌面版应用，网页版不支持此功能

### 悬浮窗口无法拖拽

- **原因**：CSS 配置问题
- **解决**：检查标题栏是否有 `-webkit-app-region: drag` 属性

### 数据不同步

- **原因**：IPC 通信失败
- **解决**：
  1. 重启应用
  2. 查看开发者工具控制台是否有错误信息
  3. 确认使用最新版本

### 窗口关闭后无法再次打开

- **原因**：窗口引用未正确清理
- **解决**：重启应用即可恢复

## 📝 开发指南

### 文件结构

```
infinitynote/
├── electron/
│   ├── main.cjs              # 悬浮窗口管理逻辑
│   └── preload.cjs           # API 暴露
├── floating.html             # 悬浮窗口 HTML 入口
├── src/
│   ├── pages/
│   │   └── FloatingNote/
│   │       ├── index.tsx     # 悬浮窗口组件
│   │       └── index.module.css  # 样式
│   ├── components/
│   │   ├── NoteCard/         # 便签卡片（包含悬浮按钮）
│   │   └── NoteToolbar/      # 工具栏（悬浮按钮）
│   ├── types/
│   │   └── electron.d.ts     # TypeScript 类型定义
│   └── App.tsx               # 主应用（数据同步）
└── vite.config.ts            # 多入口构建配置
```

### 主要修改

1. **electron/main.cjs** - 添加悬浮窗口创建和管理
2. **electron/preload.cjs** - 暴露悬浮便签 API
3. **floating.html** - 悬浮窗口 HTML 入口
4. **src/pages/FloatingNote/index.tsx** - 悬浮窗口组件
5. **src/components/NoteToolbar/constants.ts** - 添加悬浮按钮
6. **src/components/NoteCard/index.tsx** - 处理悬浮操作
7. **src/types/electron.d.ts** - 类型定义
8. **src/App.tsx** - 数据同步逻辑
9. **vite.config.ts** - 多入口构建

## 🔮 未来计划

- [ ] 支持窗口位置和大小记忆
- [ ] 支持窗口吸附边缘
- [ ] 支持透明度调节
- [ ] 支持快捷键操作
- [ ] 支持窗口分组管理
- [ ] 支持最小化到系统托盘

## 📄 许可证

MIT License

---

**版本**: 2.0.0  
**最后更新**: 2025-10-12  
**作者**: 无限便签团队
