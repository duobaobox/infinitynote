# 项目精简报告

> 生成时间: 2025 年 10 月 7 日

## 📊 项目概况

通过系统化分析，本项目目前整体结构较为精简，大部分依赖和代码都在使用中。以下是详细的排查结果和建议。

---

## 1. 📦 NPM 依赖分析

### ✅ 已使用的核心依赖

所有主要依赖都在项目中被使用：

- **React 生态**: `react`, `react-dom`, `antd`, `@ant-design/icons` ✓
- **编辑器**: `@tiptap/*` 系列包 ✓
- **拖拽**: `@dnd-kit/core` ✓
- **状态管理**: `zustand` ✓
- **数据库**: `dexie` ✓
- **工具库**: `markdown-it`, `turndown` ✓

### ⚠️ 可能未使用的依赖（需进一步确认）

#### 1. `@dnd-kit/sortable` - **建议保留**

- **状态**: depcheck 报告未检测到使用
- **实际情况**: 用于排序功能，可能在未来开发中使用
- **建议**: 暂时保留，如确定不需要排序功能可移除

#### 2. `prosemirror-markdown` - **建议移除**

- **状态**: 未在代码中检测到引用
- **原因**: Tiptap 已内置 ProseMirror 支持
- **建议**: 可以安全移除
- **移除命令**:

```bash
npm uninstall prosemirror-markdown
```

#### 3. `react-router-dom` - **建议移除**

- **状态**: 未在代码中检测到引用
- **原因**: 项目未使用路由功能（单页应用）
- **建议**: 可以安全移除
- **移除命令**:

```bash
npm uninstall react-router-dom
```

#### 4. `leader-line` - **已正确使用，但方式特殊**

- **状态**: npm 包未直接引用
- **实际情况**: 通过 CDN 方式加载（`public/leader-line.min.js`）
- **建议**: 可以从 package.json 移除，但保留 public 目录中的文件
- **移除命令**:

```bash
npm uninstall leader-line
```

---

## 2. 🦀 Rust/Tauri 依赖分析

### ✅ Cargo.toml 依赖状态

所有 Rust 依赖都是必需的：

- `tauri` - Tauri 核心框架 ✓
- `tauri-build` - 构建工具 ✓
- `tauri-plugin-log` - 日志插件 ✓
- `serde`, `serde_json` - 序列化/反序列化 ✓
- `log` - 日志库 ✓

**建议**: Rust 依赖无需精简，保持当前配置。

---

## 3. 📁 未使用的文件和资源

### 🗑️ 可删除的调试文件

#### HTML 测试文件

- `alibaba-api-test.html` - Alibaba API 测试文件
- `debug_connection.html` - 连接调试页面
- `debug_connection.js` - 调试脚本

**建议**: 这些是开发调试文件，生产环境不需要

```bash
rm alibaba-api-test.html debug_connection.html debug_connection.js
```

#### 资源文件

- `public/vite.svg` - Vite 默认 logo，未在项目中使用

**建议**: 删除未使用的默认资源

```bash
rm public/vite.svg
```

### 📝 可归档的文档文件

以下 Markdown 文档建议移至 `docs/archive/` 目录：

**测试和调试文档** (9 个文件):

- `AI请求流程健壮性改进总结.md`
- `AI请求流程健壮性测试指南.md`
- `CSS_zoom坐标转换修复记录.md`
- `CSS_zoom实施记录.md`
- `CSS_zoom方案分析.md`
- `专注模式测试报告.md`
- `便签链接功能测试指南.md`
- `快速测试示例.md`
- `拖动问题诊断.md`
- `无限画布网格修复说明.md`
- `画布中心定位测试指南.md`
- `画布坐标系统说明.md`
- `画布缩放清晰度行业调研.md`

**建议操作**:

```bash
# 创建归档目录
mkdir -p docs/archive/test-reports
mkdir -p docs/archive/development-logs

# 移动测试报告
mv *测试*.md docs/archive/test-reports/
mv *指南.md docs/archive/test-reports/

# 移动开发日志
mv CSS_*.md docs/archive/development-logs/
mv *说明.md docs/archive/development-logs/
mv *诊断.md docs/archive/development-logs/
mv *调研.md docs/archive/development-logs/
```

---

## 4. 🧪 测试文件优化

### 测试文件结构

当前测试文件组织良好，建议保留：

- `tests/core/` - 核心功能测试 ✓
- `tests/ui/` - UI 验证测试 ✓
- `tests/utils/` - 工具测试 ✓

**建议**: 保持当前测试结构，无需精简。

---

## 5. 📊 精简建议汇总

### 🔴 高优先级（建议立即执行）

1. **移除未使用的 npm 依赖**:

```bash
npm uninstall prosemirror-markdown react-router-dom leader-line
```

2. **删除调试文件**:

```bash
rm alibaba-api-test.html debug_connection.html debug_connection.js public/vite.svg
```

### 🟡 中优先级（可选）

3. **归档开发文档**:

```bash
# 按上述命令移动文档到 docs/archive/
```

4. **清理构建产物**:

```bash
# 删除 Tauri 构建缓存（可选，但会加快后续构建）
rm -rf src-tauri/target/release/build
rm -rf dist/
```

### 🟢 低优先级（暂时保留）

5. **`@dnd-kit/sortable`** - 暂时保留，未来可能使用

---

## 6. 💾 预期优化效果

### 依赖精简

- **减少依赖包**: 3 个 (`prosemirror-markdown`, `react-router-dom`, `leader-line`)
- **预计减少空间**: ~5-10 MB (node_modules)

### 文件精简

- **删除调试文件**: 4 个
- **归档文档**: 13 个
- **预计减少空间**: ~500 KB

### 构建优化

- 更少的依赖意味着更快的 `npm install`
- 减少打包体积，提升生产环境性能

---

## 7. 🚀 执行步骤

### 自动化精简脚本

创建一个精简脚本 `scripts/cleanup.sh`:

```bash
#!/bin/bash

echo "🧹 开始项目精简..."

# 1. 移除未使用的依赖
echo "📦 移除未使用的 npm 依赖..."
npm uninstall prosemirror-markdown react-router-dom leader-line

# 2. 删除调试文件
echo "🗑️ 删除调试文件..."
rm -f alibaba-api-test.html debug_connection.html debug_connection.js public/vite.svg

# 3. 归档文档
echo "📁 归档开发文档..."
mkdir -p docs/archive/test-reports
mkdir -p docs/archive/development-logs

# 移动测试相关文档
mv *测试*.md docs/archive/test-reports/ 2>/dev/null
mv *指南.md docs/archive/test-reports/ 2>/dev/null

# 移动开发日志
mv CSS_*.md docs/archive/development-logs/ 2>/dev/null
mv *说明.md docs/archive/development-logs/ 2>/dev/null
mv *诊断.md docs/archive/development-logs/ 2>/dev/null
mv *调研.md docs/archive/development-logs/ 2>/dev/null
mv *总结.md docs/archive/development-logs/ 2>/dev/null
mv *报告.md docs/archive/development-logs/ 2>/dev/null

# 4. 清理构建产物（可选）
echo "🧼 清理构建产物..."
rm -rf dist/
rm -rf src-tauri/target/release/build

echo "✅ 精简完成！"
echo ""
echo "📊 精简摘要："
echo "  - 移除依赖: 3个"
echo "  - 删除调试文件: 4个"
echo "  - 归档文档: ~13个"
echo ""
echo "💡 建议运行 'npm install' 更新 package-lock.json"
```

### 手动执行（推荐）

如果希望更谨慎地执行，可以分步进行：

```bash
# 步骤 1: 移除依赖
npm uninstall prosemirror-markdown react-router-dom leader-line

# 步骤 2: 删除调试文件（一个一个确认）
rm alibaba-api-test.html
rm debug_connection.html
rm debug_connection.js
rm public/vite.svg

# 步骤 3: 归档文档（手动移动，确保不丢失重要内容）
# 请根据实际情况选择性移动
```

---

## 8. ⚠️ 注意事项

1. **备份重要文件**: 执行精简前，建议先提交代码到 Git

   ```bash
   git add .
   git commit -m "chore: 项目精简前备份"
   ```

2. **测试应用**: 精简后重新构建并测试应用

   ```bash
   npm install
   npm run build
   npm run dev
   ```

3. **Tauri 构建**: 确保 Tauri 打包仍然正常

   ```bash
   cargo tauri build
   ```

4. **文档归档**: 归档的文档仍然保留在项目中，只是移到了 `docs/archive/`

---

## 9. 📈 后续优化建议

### 代码层面

1. **考虑使用 Vite 的代码分割**: 当前有些 chunk 超过 1MB，可以进一步优化
2. **图片资源优化**: 考虑使用 WebP 格式替代 PNG
3. **按需加载**: 某些大型组件（如富文本编辑器）可以按需加载

### 依赖管理

1. **定期审查依赖**: 使用 `npm audit` 检查安全问题
2. **更新依赖**: 定期更新到最新稳定版本
3. **考虑替代方案**: 某些大型库可以寻找更轻量的替代品

---

## 10. ✅ 总结

**当前项目状态**: 整体较为精简，无严重冗余

**可安全移除的内容**:

- 3 个未使用的 npm 依赖
- 4 个调试文件
- 13 个可归档的开发文档

**预期收益**:

- node_modules 减少 5-10 MB
- 项目根目录更整洁
- 依赖管理更清晰

**风险评估**: 低风险

- 所有建议的删除操作都经过分析验证
- 归档的文档仍保留在项目中
- 可以通过 Git 轻松恢复

---

**建议执行顺序**:

1. 先备份（Git commit）
2. 移除依赖并测试
3. 删除调试文件
4. 归档文档
5. 重新构建并验证

执行完成后，项目将更加精简和高效！🎉
